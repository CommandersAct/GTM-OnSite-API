___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Commanders Act CMP",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "A template using \"Commanders Act\" OnSite CMP API to manage \"Consent Mode\" in GTM.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "caTrustAdStorageCatId",
    "displayName": "Consent Category Id for \"Ad Storage\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Ad Storage\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustAnalyticsStorageCatId",
    "displayName": "Consent Category Id for \"Analytics Storage\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Analytics Storage\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustFunctionalityStorageCatId",
    "displayName": "Consent Category Id for \"Functionality Storage\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Functionality Storage\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustPersonalizationStorageCatId",
    "displayName": "Consent Category Id for \"Personalization Storage\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Personalization Storage\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustSecurityStorageCatId",
    "displayName": "Consent Category Id for \"Security Storage\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Security Storage\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustAdUserDataCatId",
    "displayName": "Consent Category Id for \"Ad User Data\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Ad User Data\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "caTrustAdPersonalizationCatId",
    "displayName": "Consent Category Id for \"Ad Personalization\"",
    "simpleValueType": true,
    "help": "Log in into \"Commanders Act\" interface and locate the area \"Data Governance\" → \"Consent Management\" → \"Categories\". Input the category Id (E.g. 1) associated to \"Ad Personalization\". More details are available by following this \u003ca href\u003d\"https://doc.commandersact.com/features/consent-management/user-guides/categories-and-tags/manage-categories\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "TEXT",
    "name": "waitforUpdate",
    "displayName": "Wait for update",
    "simpleValueType": true,
    "help": "Set how long to wait, in miliseconds, before sending data (Default 0).",
    "valueUnit": "Milliseconds",
    "valueValidators": [
      {
        "type": "POSITIVE_NUMBER"
      }
    ],
    "valueHint": "500"
  },
  {
    "type": "GROUP",
    "name": "defaultAdStorageGroup",
    "displayName": "Default Consent for \"Ad Storage\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultAdStorageTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ],
            "errorMessage": ""
          }
        ],
        "help": "Default status for \"Ad Storage\" before interacting with the privacy banner and by region.\nLeave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultAnalyticsGroup",
    "displayName": "Default Consent for \"Analytics Storage\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultAnalyticsStorageTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Analytics Storage\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultFunctionalityGroup",
    "displayName": "Default Consent for \"Functionality Storage\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultFunctionalityStorageTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Functionality Storage\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultPersonalizationGroup",
    "displayName": "Default Consent for \"Personalization Storage\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultPersonalizationStorageTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Personalization Storage\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultSecurityGroup",
    "displayName": "Default Consent for \"Security Storage\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultSecurityStorageTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Security Storage\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultAdUserDataGroup",
    "displayName": "Default Consent for \"Ad User Data\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultAdUserDataTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Ad User Data\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "defaultAdPersonalizationGroup",
    "displayName": "Default Consent for \"Ad Personalization\"",
    "groupStyle": "NO_ZIPPY",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "defaultAdPersonalizationTable",
        "displayName": "Mapping",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Default Consent",
            "name": "default_consent",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "denied",
                "displayValue": "Denied"
              },
              {
                "value": "granted",
                "displayValue": "Granted"
              }
            ],
            "macrosInSelect": false
          },
          {
            "defaultValue": "",
            "displayName": "Region",
            "name": "region",
            "type": "TEXT"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY",
            "enablingConditions": [
              {
                "paramName": "disableDefaultConsent",
                "paramValue": false,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "help": "Default status for \"Ad Personalization\" before interacting with the privacy banner and by region. Leave the \"Region\" field empty to apply your selection to all regions."
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "enableUrlPassthrough",
    "checkboxText": "Enable \"URL Passthrough\"",
    "simpleValueType": true,
    "help": "Activate \"URL Passthrough\". For more information, you can check this \u003ca href\u003d\"https://developers.google.com/tag-platform/devguides/consent#passing_ad_click_client_id_and_session_id_information_in_urls\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "CHECKBOX",
    "name": "enableAdsDataRedaction",
    "checkboxText": "Enable \"Ads Data Redaction\"",
    "simpleValueType": true,
    "help": "Activate \"Ads Data Redaction\". For more information, you can check this \u003ca href\u003d\"https://developers.google.com/tag-platform/devguides/consent#redact_ads_data\" target\u003d\"_blank\"\u003eLINK\u003c/a\u003e."
  },
  {
    "type": "CHECKBOX",
    "name": "advancedFeatures",
    "checkboxText": "Advanced Features",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "advancedFeaturesGroup",
    "displayName": "Advanced Features",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "injectCmpJsFlag",
        "checkboxText": "Inject CMP Script",
        "simpleValueType": true,
        "help": "You can directly inject Commanders Act CMP Script selecting this option."
      },
      {
        "type": "TEXT",
        "name": "injectCmpJsFullUrl",
        "displayName": "URL:",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "injectCmpJsFlag",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "help": "Enter your Commanders Act CMP Script full URL."
      },
      {
        "type": "CHECKBOX",
        "name": "disableDefaultConsent",
        "checkboxText": "Disable Default Consent",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "advancedFeatures",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "help": "Disabling the default consent may come handy when you don\u0027t want to use the Consent Mode."
      },
      {
        "type": "CHECKBOX",
        "name": "activateReactiveEvents",
        "checkboxText": "Activate Reactive Events",
        "simpleValueType": true,
        "help": "Third-party vendor tags require additional settings to properly operate with the user consent."
      },
      {
        "type": "GROUP",
        "name": "reactiveEventGroup",
        "displayName": "Reactive Events",
        "groupStyle": "ZIPPY_OPEN",
        "subParams": [
          {
            "type": "CHECKBOX",
            "name": "activateAdEvent",
            "checkboxText": "Activate \"Ad Storage\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "adEventName",
            "displayName": "Ad Storage Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Ad Storage\". Default name: \"reactiveAdOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveAdOn",
            "enablingConditions": [
              {
                "paramName": "activateAdEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activateAnalyticsEvent",
            "checkboxText": "Activate \"Analytics Storage\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "analyticsEventName",
            "displayName": "Analytics Storage Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Analytics Storage\". Default name: \"reactiveAnalyticsOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveAnalyticsOn",
            "enablingConditions": [
              {
                "paramName": "activateAnalyticsEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activateFunctionalityEvent",
            "checkboxText": "Activate \"Functionality Storage\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "functionalityEventName",
            "displayName": "Functionality Storage Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Functionality Storage\". Default name: \"reactiveFunctionalityOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveFunctionalityOn",
            "enablingConditions": [
              {
                "paramName": "activateFunctionalityEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activatePersonalizationEvent",
            "checkboxText": "Activate \"Personalization Storage\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "personalizationEventName",
            "displayName": "Personalization Storage Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Personalization Storage\". Default name: \"reactivePersonalizationOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactivePersonalizationOn",
            "enablingConditions": [
              {
                "paramName": "activatePersonalizationEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activateSecurityEvent",
            "checkboxText": "Activate \"Security Storage\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "securityEventName",
            "displayName": "Security Storage Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Security Storage\". Default name: \"reactiveSecurityOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveSecurityOn",
            "enablingConditions": [
              {
                "paramName": "activateSecurityEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activateAdUserDataEvent",
            "checkboxText": "Activate \"Ad User Data\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "adUserDataEventName",
            "displayName": "Ad User Data Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Ad User Data\". Default name: \"reactiveAdUserDataOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveAdUserDataOn",
            "enablingConditions": [
              {
                "paramName": "activateAdUserDataEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          },
          {
            "type": "CHECKBOX",
            "name": "activateAdPersonalizationEvent",
            "checkboxText": "Activate \"Ad Personalization\" Reactive Event",
            "simpleValueType": true
          },
          {
            "type": "TEXT",
            "name": "adPersonalizationEventName",
            "displayName": "Ad Personalization Event Name:",
            "simpleValueType": true,
            "help": "GTM custom reactive event name for \"Ad Personalization\". Default name: \"reactiveAdPersonalizationOn\". You need to configure a \"Custom Event\" trigger using the same event name.",
            "defaultValue": "reactiveAdPersonalizationOn",
            "enablingConditions": [
              {
                "paramName": "activateAdPersonalizationEvent",
                "paramValue": true,
                "type": "EQUALS"
              }
            ]
          }
        ],
        "enablingConditions": [
          {
            "paramName": "activateReactiveEvents",
            "paramValue": true,
            "type": "EQUALS"
          }
        ]
      }
    ],
    "enablingConditions": [
      {
        "paramName": "advancedFeatures",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const createArgumentsQueue = require('createArgumentsQueue');
const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const queryPermission = require('queryPermission');
const injectScript = require('injectScript');
const logToConsole = require('logToConsole');
const makeInteger = require('makeInteger');
const createQueue = require('createQueue');
const gtagSet = require('gtagSet');
const JSON = require('JSON');

if (data.advancedFeatures && data.injectCmpJsFlag && data.injectCmpJsFullUrl) {
  if (queryPermission('inject_script', data.injectCmpJsFullUrl)) {
    logToConsole('Injecting CMP Script...');
    injectScript(data.injectCmpJsFullUrl, onSuccess, data.gtmOnFailure, data.injectCmpJsFullUrl);
  } else {
    logToConsole('ERROR | Script load failed due to permissions mismatch.');
  }
}
function onSuccess() {
  logToConsole('CMP Script successfully loaded!');
}

gtagSet('developer_id.dOWVhY2', true);
if (data.enableUrlPassthrough) {
  gtagSet('url_passthrough', true);
  logToConsole("Commanders Act | OnSite API: Url Passthrough set to TRUE");
}
if (data.enableAdsDataRedaction) {
  gtagSet('ads_data_redaction', true);
  logToConsole("Commanders Act | OnSite API: Ads Data Redaction set to TRUE");
}

function setDefaultConsentByRegion(defaultTable, storageType) {
  let regionDenied = [], regionGranted = [];
  if (defaultTable) {
    for (let i = 0; i < defaultTable.length; i++) {
      if (defaultTable[i].default_consent === "denied") {
        // Consent denied branch...
        if (defaultTable[i].region !== "") {
          regionDenied.push(defaultTable[i].region);
        } else {
          //No input region: send a "setDefaultConsentState" for all regions.
          logToConsole("Default Consent State | " + storageType + " | regionDenied: ALL");
          let consentSettings = {};
          consentSettings[storageType] = "denied";
          consentSettings.wait_for_update = (typeof data.waitforUpdate !== "undefined") ? makeInteger(data.waitforUpdate) : 0;
          setDefaultConsentState(consentSettings);
        }
      } else if (defaultTable[i].default_consent === "granted") {
        // Consent granted branch...
        if (defaultTable[i].region !== "") {
          regionGranted.push(defaultTable[i].region);
        } else {
          //No input region: send a "setDefaultConsentState" for all regions.
          logToConsole("Default Consent State | " + storageType + " | regionGranted: ALL");
          let consentSettings = {};
          consentSettings[storageType] = "granted";
          consentSettings.wait_for_update = (typeof data.waitforUpdate !== "undefined") ? makeInteger(data.waitforUpdate) : 0;
          setDefaultConsentState(consentSettings);
        }
      }
    }
    if (regionDenied.length > 0) {
      let consentSettings = {};
      consentSettings[storageType] = "denied";
      consentSettings.region = regionDenied;
      consentSettings.wait_for_update = (typeof data.waitforUpdate !== "undefined") ? makeInteger(data.waitforUpdate) : 0;
      setDefaultConsentState(consentSettings);
      logToConsole("Default Consent State | " + storageType + " | regionDenied:" + regionDenied.toString());
    }
    if (regionGranted.length > 0) {
      let consentSettings = {};
      consentSettings[storageType] = "granted";
      consentSettings.region = regionGranted;
      consentSettings.wait_for_update = (typeof data.waitforUpdate !== "undefined") ? makeInteger(data.waitforUpdate) : 0;
      setDefaultConsentState(consentSettings);
      logToConsole("Default Consent State | " +storageType + " | regionGranted: " + regionGranted.toString());
    }
  }
}

if (!data.disableDefaultConsent) {
  // Default settings via "setDefaultConsentState" API.
  logToConsole("Firing default command(s)...");
    
  setDefaultConsentByRegion(data.defaultAdStorageTable, "ad_storage");
  setDefaultConsentByRegion(data.defaultAnalyticsStorageTable, "analytics_storage");
  setDefaultConsentByRegion(data.defaultFunctionalityStorageTable, "functionality_storage");
  setDefaultConsentByRegion(data.defaultPersonalizationStorageTable, "personalization_storage");
  setDefaultConsentByRegion(data.defaultSecurityStorageTable, "security_storage");
  setDefaultConsentByRegion(data.defaultAdUserDataTable, "ad_user_data");
  setDefaultConsentByRegion(data.defaultAdPersonalizationTable, "ad_personalization");
}

// CA Stub is initialized via "createArgumentsQueue" API
const cact = createArgumentsQueue('cact', 'caReady');
logToConsole("CA Stub initialized...");
let caPrevConsent = "";

function setConsentUpdateCommand (result) {
    const adObj = result.consent.categories[data.caTrustAdStorageCatId] || {};
    const analyticsObj = result.consent.categories[data.caTrustAnalyticsStorageCatId] || {};
    const functionalityObj = result.consent.categories[data.caTrustFunctionalityStorageCatId] || {};
    const personalizationObj = result.consent.categories[data.caTrustPersonalizationStorageCatId] || {};
    const securityObj = result.consent.categories[data.caTrustSecurityStorageCatId] || {};
	const adUserDataObj = result.consent.categories[data.caTrustAdUserDataCatId] || {};
	const adPersonalizationObj = result.consent.categories[data.caTrustAdPersonalizationCatId] || {};
	
    let adStatus = "", analyticsStatus = "", functionalityStatus = "", personalizationStatus = "", securityStatus = "", adUserDataStatus = "", adPersonalizationStatus = "";
    if (adObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdStorageCatId + " is granted!");
        adStatus = "granted";
    } else if (adObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdStorageCatId + " is denied!");
        adStatus = "denied";
    }
    if (analyticsObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAnalyticsStorageCatId + " is granted!");
        analyticsStatus = "granted";
    } else if (analyticsObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAnalyticsStorageCatId + " is denied!");
        analyticsStatus = "denied";
    }
    if (functionalityObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustFunctionalityStorageCatId + " is granted!");
        functionalityStatus = "granted";
    } else if (functionalityObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustFunctionalityStorageCatId + " is denied!");
        functionalityStatus = "denied";
    }
    if (personalizationObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustPersonalizationStorageCatId + " is granted!");
        personalizationStatus = "granted";
    } else if (personalizationObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustPersonalizationStorageCatId + " is denied!");
        personalizationStatus = "denied";
    }
    if (securityObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustSecurityStorageCatId + " is granted!");
        securityStatus = "granted";
    } else if (securityObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustSecurityStorageCatId + " is denied!");
        securityStatus = "denied";
    }
	if (adUserDataObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdUserDataCatId + " is granted!");
        adUserDataStatus = "granted";
    } else if (adUserDataObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdUserDataCatId + " is denied!");
        adUserDataStatus = "denied";
    }
	if (adPersonalizationObj.status === 'on') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdPersonalizationCatId + " is granted!");
        adPersonalizationStatus = "granted";
    } else if (adPersonalizationObj.status === 'off') {
        logToConsole("Commanders Act | OnSite API: consent.onUpdate | Category ID: " + data.caTrustAdPersonalizationCatId + " is denied!");
        adPersonalizationStatus = "denied";
    }
	
    logToConsole("Firing update command...");
    updateConsentState({
        'ad_storage': adStatus,
        'analytics_storage': analyticsStatus,
        'functionality_storage': functionalityStatus,
        'personalization_storage': personalizationStatus,
        'security_storage': securityStatus,
		'ad_user_data': adUserDataStatus,
		'ad_personalization': adPersonalizationStatus,
        'wait_for_update': (typeof data.waitforUpdate !== "undefined") ? makeInteger(data.waitforUpdate) : 0
    });
    if (data.advancedSettings && data.activateReactiveEvents) {
      const dataLayerPush = createQueue('dataLayer');
      if (data.activateAdEvent) {
        dataLayerPush({
          'event': data.adEventName
        });
      }
      if (data.analyticsEventName) {
        dataLayerPush({
          'event': data.analyticsEventName
        });
      }
      if (data.functionalityEventName) {
        dataLayerPush({
          'event': data.functionalityEventName
        });
      }
      if (data.personalizationEventName) {
        dataLayerPush({
          'event': data.personalizationEventName
        });
      }
      if (data.securityEventName) {
        dataLayerPush({
          'event': data.securityEventName
        });
      }
	  if (data.adUserDataEventName) {
        dataLayerPush({
          'event': data.adUserDataEventName
        });
      }
	  if (data.adPersonalizationEventName) {
        dataLayerPush({
          'event': data.adPersonalizationEventName
        });
      }
    }
}

cact('consent.get', function (result) {
	logToConsole("Commanders Act | OnSite API: consent.get");
    logToConsole("result: ", result);
    if (result.consent.status !== "unset") {
        setConsentUpdateCommand(result);
    }
    caPrevConsent = result;
});

cact('consent.onUpdate', function (result) {
  logToConsole("Commanders Act | OnSite API: consent.onUpdate");
  logToConsole("result: ", result);
  setConsentUpdateCommand(result);

  if (data.advancedFeatures && data.activateReactiveEvents) {
    const dataLayerPush = createQueue('dataLayer');
    if (data.activateAdEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustAdStorageCatId].status !== "on") && 
          (result.consent.categories[data.caTrustAdStorageCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Ad Storage' is now on (was off)...");
        dataLayerPush({
          'event': data.adEventName
        });
      }
    }
    if (data.activateAnalyticsEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustAnalyticsStorageCatId].status !== "on") && 
          (result.consent.categories[data.caTrustAnalyticsStorageCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Analytics Storage' is now on (was off)...");
        dataLayerPush({
          'event': data.analyticsEventName
        });
      }
    }
    if (data.activateFunctionalityEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustFunctionalityStorageCatId].status !== "on") && 
          (result.consent.categories[data.caTrustFunctionalityStorageCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Functionality Storage' is now on (was off)...");
        dataLayerPush({
          'event': data.functionalityEventName
        });
      }
    }
    if (data.activatePersonalizationEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustPersonalizationStorageCatId].status !== "on") && 
          (result.consent.categories[data.caTrustPersonalizationStorageCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Personalization Storage' is now on (was off)...");
        dataLayerPush({
          'event': data.personalizationEventName
        });
      }
    }
    if (data.activateSecurityEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustSecurityStorageCatId].status !== "on") && 
          (result.consent.categories[data.caTrustSecurityStorageCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Security Storage' is now on (was off)...");
        dataLayerPush({
          'event': data.securityEventName
        });
      }
    }
	if (data.activateAdUserDataEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustAdUserDataCatId].status !== "on") && 
          (result.consent.categories[data.caTrustAdUserDataCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Ad User Data' is now on (was off)...");
        dataLayerPush({
          'event': data.adUserDataEventName
        });
      }
    }
	if (data.activateAdPersonalizationEvent) {
      if ((caPrevConsent.consent.categories[data.caTrustAdPersonalizationCatId].status !== "on") && 
          (result.consent.categories[data.caTrustAdPersonalizationCatId].status === "on")) {
        logToConsole("Commanders Act | Notify GTM that 'Ad Personalization' is now on (was off)...");
        dataLayerPush({
          'event': data.adPersonalizationEventName
        });
      }
    }
  }
});

data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "caReady"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "cact"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.trustcommander.net/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "developer_id.dOWVhY2"
              },
              {
                "type": 1,
                "string": "url_passthrough"
              },
              {
                "type": 1,
                "string": "ads_data_redaction"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 28/12/2021, 10:37:09


